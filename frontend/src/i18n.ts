import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'

const LANGUAGE_STORAGE_KEY = 'cozyledger.locale'

function resolveInitialLanguage(): 'en' | 'zh' {
  const storedLanguage = (globalThis.localStorage?.getItem(LANGUAGE_STORAGE_KEY) ?? '').toLowerCase()
  if (storedLanguage === 'zh' || storedLanguage === 'en') {
    return storedLanguage
  }

  const browserLanguage = (globalThis.navigator?.language ?? 'en').toLowerCase()
  return browserLanguage.startsWith('zh') ? 'zh' : 'en'
}

const resources = {
  en: {
    translation: {
      appTitle: 'CozyLedger',
      languageLabel: 'Language',
      navTransactions: 'Transactions',
      navDashboard: 'Home',
      navLedger: 'Ledger',
      navReports: 'Reports',
      navNewTransaction: 'New',
      navAccounts: 'Accounts',
      navSettings: 'Settings',
      navMembers: 'Members',
      signOut: 'Sign out',
      settingsTitle: 'Settings',
      settingsHint: 'Manage language and account actions.',
      accountActionsTitle: 'Account',
      categoriesTitle: 'Categories',
      manageCategories: 'Manage categories',
      categoriesSettingsHint: 'Create and edit categories in settings.',
      backButton: 'Back',

      setupTitle: 'Get Started',
      setupHint: 'Register or login first, then create your first book.',
      emailLabel: 'Email',
      passwordLabel: 'Password',
      registerButton: 'Register',
      loginButton: 'Login',
      loginErrorAuth: 'Login failed. Check your email and password.',
      loginErrorNetwork: 'Network error. Please check your connection and try again.',
      loginErrorGeneric: 'Unable to log in right now. Please try again.',
      bookNameLabel: 'Book name',
      baseCurrencyLabel: 'Base currency',
      tokenLabel: 'Token',
      createBookButton: 'Create book',

      dashboardTitle: 'Household Snapshot',
      homeGreeting: 'Good morning,',
      homeUserName: 'Alex Johnson',
      homeNotificationAria: 'Notifications',
      homeTotalBalance: 'Total Balance',
      homeThisMonth: 'This month',
      homeAddIncome: 'Add Income',
      homeAddExpense: 'Add Expense',
      homeActionReports: 'Reports',
      homeTopExpenseCategories: 'Top Expense Categories',
      homeCurrentMonthDistribution: 'Current month distribution',
      homeRecentTransactions: 'Recent Transactions',
      homeFallbackTransaction: 'Transaction',
      summaryIncome: 'Income',
      summaryExpense: 'Expense',
      summaryNet: 'Net',
      topExpenseCategoriesMonth: 'Top Expense Categories (This Month)',
      noDataYet: 'No data yet.',
      noCategories: 'No categories yet.',

      accountsTitle: 'Accounts',
      editAccount: 'Edit account',
      createAccount: 'Create account',
      nameLabel: 'Name',
      currencyLabel: 'Currency',
      typeLabel: 'Type',
      saveAccount: 'Save account',
      addAccount: 'Add account',
      editCategory: 'Edit category',
      createCategory: 'Create category',
      activeLabel: 'Active',
      saveCategory: 'Save category',
      addCategory: 'Add category',
      editButton: 'Edit',
      typeCash: 'Cash',
      typeBank: 'Bank',
      typeCreditCard: 'Credit Card',
      typeInvestment: 'Investment',
      typeLiability: 'Liability',
      typeOther: 'Other',
      typeIncome: 'Income',
      typeExpense: 'Expense',

      ledgerTitle: 'Ledger',
      ledgerListTitle: 'Transactions',
      ledgerNewTitle: 'Add Transaction',
      ledgerFilterAll: 'All',
      ledgerSearchPlaceholder: 'Search transactions...',
      ledgerNoResults: 'No transactions found.',
      editTransaction: 'Edit transaction',
      createTransaction: 'Create transaction',
      dateUtcLabel: 'Date (UTC)',
      amountLabel: 'Amount',
      accountLabel: 'Account',
      destinationAccountLabel: 'Destination account',
      categoryLabel: 'Category',
      noteLabel: 'Note',
      refundLabel: 'Refund',
      saveTransaction: 'Save transaction',
      addTransaction: 'Add transaction',
      cancelEdit: 'Cancel edit',
      transactionsTitle: 'Transactions',
      noTransactions: 'No transactions yet.',
      typeTransfer: 'Transfer',
      typeBalanceAdjustment: 'Balance Adjustment',
      typeLiabilityAdjustment: 'Liability Adjustment',

      membersTitle: 'Members & Invites',
      membersSubtitle: 'Share access with collaborators',
      membersGenerateTitle: 'Generate Invite',
      membersAcceptTitle: 'Accept Invite',
      generateInvite: 'Generate invite',
      createInviteLink: 'Create invite link',
      inviteTokenLabel: 'Token',
      inviteUrlLabel: 'URL',
      acceptInvite: 'Accept invite',
      inviteTokenInput: 'Invite token',
      joinBook: 'Join book',

      reportsTitle: 'Reports',
      reportsTabOverview: 'Overview',
      reportsTabCategories: 'Categories',
      reportsSaved: 'Saved',
      reportsIncomeVsExpense: 'Income vs Expense',
      reportsMonthlyTotalsIn: 'Monthly totals in {{currency}}',
      reportsBreakdownTitle: 'Breakdown',
      yearLabel: 'Year',
      monthLabel: 'Month',
      categoryViewLabel: 'Category view',
      summaryTitle: 'Summary',
      summaryCurrencyHint: 'Totals are shown in the book base currency.',
      categoryDistributionTitle: 'Category Distribution',
      categoryDistributionHint: 'Each slice/bar value is expressed in base currency.',
      noCategoryData: 'No category data for selected month.',
      amountWithCurrency: 'Amount',

      accountsHint: 'Select an account to view details and manage actions.',
      accountsManageSubtitle: 'Manage all household money sources',
      accountActionsMenu: 'Account actions',
      accountDetailsTitle: 'Account details',
      accountNoSelection: 'No account selected.',
      accountBalanceLabel: 'Balance',
      noAccounts: 'No accounts yet.',
      deleteAccount: 'Delete account',
      deleteAccountConfirm: 'Delete account "{{name}}"?',
      deleteAccountBlocked: 'Cannot delete this account because transactions reference it.',
      settingsAccountsHint: 'Manage your account list',
      settingsMembersHint: 'Invite and join books',
      settingsCategoriesHint: 'Create and update categories',
      settingsQuickLanguageToggle: 'Quick Language Toggle',
      settingsQuickLanguageHint: 'Switch between EN and 中文',
      categoriesSubtitle: 'Create and edit category definitions'
    }
  },
  zh: {
    translation: {
      appTitle: '温馨账本',
      languageLabel: '语言',
      navTransactions: '流水',
      navDashboard: '首页',
      navLedger: '流水',
      navReports: '报表',
      navNewTransaction: '记一笔',
      navAccounts: '账户',
      navSettings: '设置',
      navMembers: '成员',
      signOut: '退出登录',
      settingsTitle: '设置',
      settingsHint: '管理语言和账户操作。',
      accountActionsTitle: '账户',
      categoriesTitle: '分类',
      manageCategories: '管理分类',
      categoriesSettingsHint: '在设置中创建和编辑分类。',
      backButton: '返回',

      setupTitle: '开始使用',
      setupHint: '请先注册或登录，然后创建你的第一个账本。',
      emailLabel: '邮箱',
      passwordLabel: '密码',
      registerButton: '注册',
      loginButton: '登录',
      loginErrorAuth: '登录失败，请检查邮箱和密码。',
      loginErrorNetwork: '网络异常，请检查连接后重试。',
      loginErrorGeneric: '暂时无法登录，请稍后重试。',
      bookNameLabel: '账本名称',
      baseCurrencyLabel: '基础币种',
      tokenLabel: '令牌',
      createBookButton: '创建账本',

      dashboardTitle: '家庭概览',
      homeGreeting: '早上好，',
      homeUserName: 'Alex Johnson',
      homeNotificationAria: '通知',
      homeTotalBalance: '总余额',
      homeThisMonth: '本月',
      homeAddIncome: '记收入',
      homeAddExpense: '记支出',
      homeActionReports: '报表',
      homeTopExpenseCategories: '支出分类排行',
      homeCurrentMonthDistribution: '本月分布',
      homeRecentTransactions: '最近交易',
      homeFallbackTransaction: '交易',
      summaryIncome: '收入',
      summaryExpense: '支出',
      summaryNet: '净额',
      topExpenseCategoriesMonth: '本月支出分类排行',
      noDataYet: '暂无数据。',
      noCategories: '暂无分类。',

      accountsTitle: '账户',
      editAccount: '编辑账户',
      createAccount: '新建账户',
      nameLabel: '名称',
      currencyLabel: '币种',
      typeLabel: '类型',
      saveAccount: '保存账户',
      addAccount: '添加账户',
      editCategory: '编辑分类',
      createCategory: '新建分类',
      activeLabel: '启用',
      saveCategory: '保存分类',
      addCategory: '添加分类',
      editButton: '编辑',
      typeCash: '现金',
      typeBank: '银行卡',
      typeCreditCard: '信用卡',
      typeInvestment: '投资',
      typeLiability: '负债',
      typeOther: '其他',
      typeIncome: '收入',
      typeExpense: '支出',

      ledgerTitle: '流水',
      ledgerListTitle: '交易列表',
      ledgerNewTitle: '新增交易',
      ledgerFilterAll: '全部',
      ledgerSearchPlaceholder: '搜索交易...',
      ledgerNoResults: '未找到交易记录。',
      editTransaction: '编辑交易',
      createTransaction: '新建交易',
      dateUtcLabel: '日期 (UTC)',
      amountLabel: '金额',
      accountLabel: '账户',
      destinationAccountLabel: '目标账户',
      categoryLabel: '分类',
      noteLabel: '备注',
      refundLabel: '退款',
      saveTransaction: '保存交易',
      addTransaction: '添加交易',
      cancelEdit: '取消编辑',
      transactionsTitle: '交易列表',
      noTransactions: '暂无交易。',
      typeTransfer: '转账',
      typeBalanceAdjustment: '余额调整',
      typeLiabilityAdjustment: '负债调整',

      membersTitle: '成员与邀请',
      membersSubtitle: '与协作者共享账本访问',
      membersGenerateTitle: '生成邀请',
      membersAcceptTitle: '接受邀请',
      generateInvite: '生成邀请',
      createInviteLink: '创建邀请链接',
      inviteTokenLabel: '令牌',
      inviteUrlLabel: '链接',
      acceptInvite: '接受邀请',
      inviteTokenInput: '邀请令牌',
      joinBook: '加入账本',

      reportsTitle: '报表',
      reportsTabOverview: '总览',
      reportsTabCategories: '分类',
      reportsSaved: '结余',
      reportsIncomeVsExpense: '收入与支出',
      reportsMonthlyTotalsIn: '月度总额（{{currency}}）',
      reportsBreakdownTitle: '明细',
      yearLabel: '年份',
      monthLabel: '月份',
      categoryViewLabel: '分类视图',
      summaryTitle: '汇总',
      summaryCurrencyHint: '所有数值均使用账本基础币种。',
      categoryDistributionTitle: '分类分布',
      categoryDistributionHint: '每个图表值都以基础币种显示。',
      noCategoryData: '所选月份没有分类数据。',
      amountWithCurrency: '金额',

      accountsHint: '选择账户以查看详情并进行管理。',
      accountsManageSubtitle: '管理所有家庭资金账户',
      accountActionsMenu: '账户操作',
      accountDetailsTitle: '账户详情',
      accountNoSelection: '未选择账户。',
      accountBalanceLabel: '余额',
      noAccounts: '暂无账户。',
      deleteAccount: '删除账户',
      deleteAccountConfirm: '确认删除账户“{{name}}”吗？',
      deleteAccountBlocked: '该账户已被交易引用，无法删除。',
      settingsAccountsHint: '管理账户列表',
      settingsMembersHint: '邀请成员并加入账本',
      settingsCategoriesHint: '创建和更新分类',
      settingsQuickLanguageToggle: '快速切换语言',
      settingsQuickLanguageHint: '在中英文之间切换',
      categoriesSubtitle: '创建和编辑分类定义'
    }
  }
} as const

void i18n.use(initReactI18next).init({
  resources,
  lng: resolveInitialLanguage(),
  fallbackLng: 'en',
  interpolation: {
    escapeValue: false
  }
})

i18n.on('languageChanged', (language) => {
  if (language === 'en' || language === 'zh') {
    globalThis.localStorage?.setItem(LANGUAGE_STORAGE_KEY, language)
  }
})

export default i18n
